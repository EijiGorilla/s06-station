"use strict";(self.webpackChunks06_station=self.webpackChunks06_station||[]).push([[73814],{73814:(e,t,r)=>{r.d(t,{load:()=>y});var a=r(50076),l=r(13096),n=r(11668),o=r(77491),i=r(24883),u=r(79942),s=r(64130),d=r(72945),c=r(81589),p=r(67061);async function y(e,t){const r=e.instance.portalItem;if(null!==r&&void 0!==r&&r.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(null===t||void 0===t||!t.type||!e.supportedTypes.includes(t.type))throw new a.default("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:null===t||void 0===t?void 0:t.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),async function(e,t){var r;const l=e.instance,i=l.portalItem;if(!i)return;const{url:y,title:f}=i,w=(0,u.v)(i,"portal-item");if("group"===l.type)return async function(e,t,r){const l=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:i,type:c}=l;if("Group Layer"===c){if(!(0,d.Y)(l,"Map"))throw new a.default("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e,t){var r;const l=e.portalItem,n=await l.fetchData("json");if(!n)return;if(!t.populateGroupLayer)throw new a.default("portal:missing-populate-group-layer","Missing populate group layer");const o=(0,u.v)(l,"web-map");e.read(n,o),await t.populateGroupLayer(e,n,{context:o}),e.resourceReferences={portalItem:l,paths:null!==(r=o.readResourcePaths)&&void 0!==r?r:[]}}(e,r)}return e.read({title:i},t),async function(e,t){let r;const{portalItem:l}=e;if(!l)return;const i=l.type,u=t.layerModuleTypeMap;if(!u)throw new a.default("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(i){case"Feature Service":case"Feature Collection":r=u.FeatureLayer;break;case"Stream Service":r=u.StreamLayer;break;case"Scene Service":r=u.SceneLayer;break;default:throw new a.default("portal:unsupported-item-type-as-group","The item type '".concat(i,"' is not supported as a 'IGroupLayer'"))}const d=new o.v;let[c,y]=await Promise.all([r(),m(t,d)]),f=()=>c;if("Feature Service"===i){var w;const t=null===(w=(0,s.pJ)(y))||void 0===w?void 0:w.customParameters;y=l.url?await(0,s.bO)(y,l.url,d):{},f=await async function(e,t){const{layers:r,tables:a}=e,l=[...null!==r&&void 0!==r?r:[],...null!==a&&void 0!==a?a:[]];if(!l.length)return;const n=new Set,o=[];for(const{layerType:d}of l){const e=null!==d&&void 0!==d?d:"ArcGISFeatureLayer";if(n.has(e))continue;n.add(e);const r=t[(0,s.K8)(e)];o.push(r())}const i=await Promise.all(o),u=new Map;return Array.from(n).forEach((e,t)=>{u.set(e,i[t])}),e=>{let{layerType:t}=e;const r=null!==t&&void 0!==t?t:"ArcGISFeatureLayer";return u.get(r)}}(y,u)||f;const r=await async function(e,t){const{layersJSON:r}=await(0,n.Q)(e,t);if(!r)return null;const a=[...r.layers,...r.tables];return e=>a.find(t=>t.id===e.id)}(l.url,{customParameters:t,loadContext:d});return await v(e,f,f,y,u,r)}return"Scene Service"===i&&l.url&&(y=await(0,s.nu)(l,y,d)),(0,s.XH)(y)>0?await v(e,f,null,y,u):await async function(e,t,r){var a,l;const{portalItem:n}=e;if(null===n||void 0===n||!n.url)return;const o=await(0,p.V)(n.url);o&&v(e,t,null,{layers:null===(a=o.layers)||void 0===a?void 0:a.map(s._r),tables:null===(l=o.tables)||void 0===l?void 0:l.map(s._r)},r)}(e,f,u)}(e,r)}(l,w,e);y&&"media"!==l.type&&l.read({url:y},w);const h=new o.v,g=await m(e,h,t);return g&&l.read(g,w),l.resourceReferences={portalItem:i,paths:null!==(r=w.readResourcePaths)&&void 0!==r?r:[]},"subtype-group"!==l.type&&l.read({title:f},w),(0,c.L)(l,w)}(e,t)}async function v(e,t,r,a,l,n){var o;let i=a.layers||[];const u=a.tables||[];if("Feature Collection"===(null===(o=e.portalItem)||void 0===o?void 0:o.type)?(i.forEach((e,t)=>{var r;e.id=t,"Table"===(null===e||void 0===e||null===(r=e.layerDefinition)||void 0===r?void 0:r.type)&&u.push(e)}),i=i.filter(e=>{var t;return"Table"!==(null===e||void 0===e||null===(t=e.layerDefinition)||void 0===t?void 0:t.type)})):(i.reverse(),u.reverse()),i.forEach(r=>{const l=null===n||void 0===n?void 0:n(r);if(l||!n){const n=f(e,t(r),a,r,l);e.add(n)}}),u.length){const t=r?null:await l.FeatureLayer();u.forEach(l=>{const o=null===n||void 0===n?void 0:n(l);if(o||!n){const n=f(e,r?r(l):t,a,l,o);e.tables.add(n)}})}}function f(e,t,r,a,l){const n=e.portalItem,o={portalItem:n.clone(),layerId:a.id};null!=a.url&&(o.url=a.url);const u=new t(o);if("sourceJSON"in u&&(u.sourceJSON=l),"subtype-group"!==u.type&&"catalog"!==u.type&&(u.sublayerTitleMode="service-name"),"Feature Collection"===n.type){const e={origin:"portal-item",portal:n.portal||i.default.getDefault()};u.read(a,e);const t=r.showLegend;null!=t&&u.read({showLegend:t},e)}return u}async function m(e,t,r){if(!1===e.supportsData)return;const a=e.instance,n=a.portalItem;if(!n)return;let o=null;try{o=await n.fetchData("json",r)}catch(c){}if(function(e){return"stream"!==e.type&&"layerId"in e}(a)){var i,u;let e=null;const r=await async function(e,t,r){var a,n,o,i,u,d,c,p,y;if(null!==t&&void 0!==t&&t.layers&&null!==t&&void 0!==t&&t.tables)return(0,s.XH)(t);const v=(0,l.qg)(e.url);if(!v)return 1;const f=await r.fetchServiceMetadata(v.url.path,{customParameters:null===(a=(0,s.pJ)(t))||void 0===a?void 0:a.customParameters}).catch(()=>null);return(null!==(n=null!==(o=null===t||void 0===t||null===(i=t.layers)||void 0===i?void 0:i.length)&&void 0!==o?o:null===f||void 0===f||null===(u=f.layers)||void 0===u?void 0:u.length)&&void 0!==n?n:0)+(null!==(d=null!==(c=null===t||void 0===t||null===(p=t.tables)||void 0===p?void 0:p.length)&&void 0!==c?c:null===f||void 0===f||null===(y=f.tables)||void 0===y?void 0:y.length)&&void 0!==d?d:0)}(n,o,t);if((null!==(i=o)&&void 0!==i&&i.layers||null!==(u=o)&&void 0!==u&&u.tables)&&r>0){var d;if(null==a.layerId){const e=(0,s.l)(a.type),t=null!==e&&void 0!==e&&e.length?(0,s.Ju)(o,e)[0]:(0,s.pJ)(o);t&&(a.layerId=t.id)}e=function(e,t){var r,a;const{layerId:l}=t,n=(null===(r=e.layers)||void 0===r?void 0:r.find(e=>e.id===l))||(null===(a=e.tables)||void 0===a?void 0:a.find(e=>e.id===l));return n&&function(e,t){const r="layerType"in e&&e.layerType,{type:a}=t;return!("feature"===a&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===a&&!r||"oriented-imagery"===a&&!r||"subtype-group"===a&&!r)}(n,t)?n:null}(o,a),"OrientedImageryLayer"===(null===(d=e)||void 0===d?void 0:d.layerType)&&"oriented-imagery"===a.type&&a.supportedSourceTypes.add("Feature Layer"),e&&null!=o.showLegend&&(e.showLegend=o.showLegend)}return r>1&&"sublayerTitleMode"in a&&"service-name"!==a.sublayerTitleMode&&(a.sublayerTitleMode="item-title-and-service-name"),e}return o}}}]);
//# sourceMappingURL=73814.3e71b45b.chunk.js.map